# Quotescom

Простое Flask-приложение для добавления, просмотра и удаления цитат с базовой аутентификацией пользователей. Проект работает в контейнере Docker и хранит данные в SQLite.

---

## Структура проекта

```
├── Dockerfile
├── MANIFEST.in
├── pyproject.toml
├── README.md                # (этот файл)
├── requirements.txt         # зависимости
└── src
    └── quotescom
        ├── static
        │   ├── css
        │   │   └── style1.css
        │   └── img
        │       └── background-image.jpg
        ├── templates
        │   ├── delete.html
        │   ├── login.html
        │   └── register.html
        ├── __init__.py
        └── web.py            # основной код приложения
```

- **`Dockerfile`** – рецепт для сборки Docker-образа.  
- **`pyproject.toml`** – метаданные пакета (имя, версия, зависимости и пр.).  
- **`requirements.txt`** – список необходимых Python-библиотек.  
- **`src/quotescom`** – сам код вашего приложения:  
  - **`web.py`** – все маршруты, модели, формы и логика работы с базой данных.  
  - **`templates/`** – HTML-шаблоны (WTForms + AJAX + Flash-сообщения).  
  - **`static/`** – CSS и статические изображения.

---

## Быстрая установка и запуск

Приведённые ниже команды рассчитаны на Linux/macOS. Если вы на Windows, адаптируйте их для PowerShell/CMD или Git Bash.

### 1. Клонируем репозиторий

```bash
git clone <URL_ВАШЕГО_РЕПОЗИТОРИЯ>
cd <имя_папки_с_репозиторием>
```

### 2. Локальный запуск (без Docker)

1. **Создаём виртуальное окружение** (рекомендуется):

   ```bash
   python3 -m venv venv
   source venv/bin/activate            
   ```

2. **Устанавливаем зависимости**:

   ```bash
   pip install --upgrade pip
   pip install -r requirements.txt
   ```

3. **Создаём каталог для базы данных** (если его нет; по умолчанию внутри контейнера он будет `/app_data`):

   ```bash
   mkdir -p app_data
   ```

4. **Задаём необходимые переменные окружения** (можно прямо в терминале или через файл `.env`):

   ```bash
   export FLASK_APP=quotescom.web:app
   export FLASK_ENV=development           # или production (но в локальной разработке обычно development)
   export SECRET_KEY="замени-на-свой-случайный-ключ"
   export APP_DATA_DIR="./app_data"       # путь к папке для хранения SQLite
   ```

5. **Запускаем приложение**:

   ```bash
   flask run --host=0.0.0.0 --port=8080
   ```

Откройте в браузере `http://localhost:8080` — и вы уже видите список цитат (пока пустой) и форму для добавления.

---

### 3. Запуск через Docker

> **Преимущества Docker-версии**: одинаковая среда на любых машинах, «никаких конфликтов» с локальными пакетами, всё «как в продакшене».

1. **Собираем Docker-образ** (находясь в корне репозитория, там, где лежит `Dockerfile`):

   ```bash
   docker build -t quotescom:latest .
   ```

2. **Запускаем контейнер** (пример):

   ```bash
   docker run -d      -p 8080:8080      -e SECRET_KEY="замени-на-свой-случайный-ключ"      -e APP_DATA_DIR="/app_data"      -v $(pwd)/app_data:/app_data      --name quotescom_app      quotescom:latest
   ```

   Пояснения:
   - `-p 8080:8080` ‒ пробрасывает порт 8080 хоста внутрь контейнера.  
   - `-e SECRET_KEY=...` ‒ секретный ключ Flask (замените на сложный и непубличный).  
   - `-e APP_DATA_DIR=/app_data` ‒ путь внутри контейнера, где хранится SQLite-файл.  
   - `-v $(pwd)/app_data:/app_data` ‒ «маунтим» локальную папку `app_data` в контейнер, чтобы база сохранялась между перезапусками.  
   - `--name quotescom_app` ‒ удобное имя контейнера.  
   - `quotescom:latest` ‒ имя образа, собранного на предыдущем шаге.

3. **Проверяем, что всё запущено**:

   - Откройте `http://localhost:8080`, чтобы увидеть приложение.  
   - Можете зайти на `http://localhost:8080/status` — вернётся JSON:  
     ```json
     {
       "status": "running",
       "message": "Quote app is alive!"
     }
     ```

4. **Остановка и удаление контейнера** (если нужно):

   ```bash
   docker stop quotescom_app
   docker rm quotescom_app
   ```

---

## Зависимости проекта

Список пакетов приведён в `requirements.txt`. Если кратко, ваше приложение зависит от:

- Python 3.8+  
- Flask (3.1.0)  
- Flask-Login (0.6.3)  
- Flask-WTF (1.2.2)  
- WTForms (3.2.1)  
- Waitress (3.0.2)  
- и ещё пару утилитов (`click`, `colorama` и пр.), которые подтягиваются автоматически.

Все версии зафиксированы, чтобы у всех одно и то же окружение.

---

## Как собрать пакет локально (setuptools + Sphinx)

> Если вам нужно собрать дистрибутив (например, `.tar.gz` или `.whl`), достаточно в корне проекта запустить:

```bash
python3 -m build
```

(предварительно `pip install build`). Это создаст папки `dist/` и `build/`.  
Подробнее про сборку пакетов можно глянуть в `pyproject.toml` и документации setuptools.

---

## Примечания

1. **База данных**:  
   - Хранится в SQLite-файле `my_database.db` внутри каталога `APP_DATA_DIR` (`./app_data` локально или `/app_data` в контейнере).  
   - При первом запуске автоматически создаются таблицы `users` и `data` (там хранятся цитаты).

2. **Аутентификация**:  
   - Регистрация (из шаблона `register.html`) → логин (из шаблона `login.html`) → теперь вы `login_required` → можете добавлять цитаты через AJAX / HTML-форму (в главном шаблоне `delete.html`).  
   - Удаление цитаты возможно только для «залогиненного» пользователя (минимальный уровень безопасности).


---

